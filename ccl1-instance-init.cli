gcloud beta compute --project=cramchallangelab1 instances create ccl1-instance-1 --zone=us-central1-f --machine-type=f1-micro --subnet=default --network-tier=PREMIUM --metadata=^,@^startup-script=\#\!\ /bin/bash$'\n'$'\n'\#$'\n'\#\ Echo\ commands\ as\ they\ are\ run,\ to\ make\ debugging\ easier.$'\n'\#\ GCE\ startup\ script\ output\ shows\ up\ in\ \"/var/log/syslog\"\ .$'\n'\#$'\n'set\ -x$'\n'$'\n'$'\n'\#$'\n'\#\ Stop\ apt-get\ calls\ from\ trying\ to\ bring\ up\ UI.$'\n'\#$'\n'export\ DEBIAN_FRONTEND=noninteractive$'\n'$'\n'$'\n'\#$'\n'\#\ Make\ sure\ installed\ packages\ are\ up\ to\ date\ with\ all\ security\ patches.$'\n'\#$'\n'apt-get\ -yq\ update$'\n'apt-get\ -yq\ upgrade$'\n'$'\n'$'\n'\#$'\n'\#\ Install\ Google\'s\ Stackdriver\ logging\ agent,\ as\ per$'\n'\#\ https://cloud.google.com/logging/docs/agent/installation$'\n'\#$'\n'curl\ -sSO\ https://dl.google.com/cloudagents/install-logging-agent.sh$'\n'bash\ install-logging-agent.sh$'\n'$'\n'$'\n'\#$'\n'\#\ Install\ and\ run\ the\ \"stress\"\ tool\ to\ max\ the\ CPU\ load\ for\ a\ while.$'\n'\#$'\n'apt-get\ -yq\ install\ stress$'\n'stress\ -c\ 8\ -t\ 120$'\n'$'\n'$'\n'\#$'\n'\#\ Report\ that\ we\'re\ done.$'\n'\#$'\n'$'\n'\#\ Metadata\ should\ be\ set\ in\ the\ \"lab-logs-bucket\"\ attribute\ using\ the\ \"gs://mybucketname/\"\ format.$'\n'log_bucket_metadata_name=ccl1-bucket-1$'\n'log_bucket_metadata_url=\"http://metadata.google.internal/computeMetadata/v1/instance/attributes/\$\{log_bucket_metadata_name\}\"$'\n'worker_log_bucket=\$\(curl\ -H\ \"Metadata-Flavor:\ Google\"\ \"\$\{log_bucket_metadata_url\}\"\)$'\n'$'\n'\#\ We\ write\ a\ file\ named\ after\ this\ machine.$'\n'worker_log_file=\"machine-\$\(hostname\)-finished.txt\"$'\n'echo\ \"Phew\!\ \ Work\ completed\ at\ \$\(date\)\"\ \>\"\$\{worker_log_file\}\"$'\n'$'\n'\#\ And\ we\ copy\ that\ file\ to\ the\ bucket\ specified\ in\ the\ metadata.$'\n'echo\ \"Copying\ the\ log\ file\ to\ the\ bucket...\"$'\n'gsutil\ cp\ \"\$\{worker_log_file\}\"\ \"\$\{worker_log_bucket\}\" --no-restart-on-failure --maintenance-policy=TERMINATE --preemptible --service-account=686807586655-compute@developer.gserviceaccount.com --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append --image=debian-10-buster-v20200618 --image-project=debian-cloud --boot-disk-size=10GB --boot-disk-type=pd-standard --boot-disk-device-name=ccl1-instance-1 --no-shielded-secure-boot --shielded-vtpm --shielded-integrity-monitoring --reservation-affinity=any